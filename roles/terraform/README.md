Role Name
=========

A brief description of the role goes here.

Requirements
------------

Any pre-requisites that may not be covered by Ansible itself or the role should be mentioned here. For instance, if the role uses the EC2 module, it may be a good idea to mention in this section that the boto package is required.

Role Variables
--------------

A description of the settable variables for this role should go here, including any variables that are in defaults/main.yml, vars/main.yml, and any variables that can/should be set via parameters to the role. Any variables that are read from other roles and/or the global scope (ie. hostvars, group vars, etc.) should be mentioned here as well.

Dependencies
------------

A list of other roles hosted on Galaxy should go here, plus any details in regards to parameters that may need to be set for other roles, or variables that are used from other roles.

Example Playbook
----------------

Including an example of how to use your role (for instance, with variables passed in as parameters) is always nice for users too:

    - hosts: servers
      roles:
         - { role: username.rolename, x: 42 }

provider is currently https://github.com/josenk/terraform-provider-esxi

NOTE: make sure to run

```console
sudo dnf install libnsl*
```

Configuration reference
-----------------------
* provider "esxi"
  * esxi_hostname - Required
  * esxi_hostport - Optional - Default "22".
  * esxi_hostssl - Optional - Default "443".
  * esxi_username - Optional - Default "root".
  * esxi_password - Required

* resource "esxi_resource_pool"
  * resource_pool_name - Required - The Resource Pool name.
  * cpu_min - Optional
  * cpu_min_expandable - Optional
  * cpu_max - Optional
  * cpu_shares - Optional
  * mem_min - Optional
  * mem_min_expandable - Optional
  * mem_max - Optional
  * mem_shares - Optional

* resource "esxi_virtual_disk"
  * virtual_disk_disk_store - Required - esxi Disk Store where virtual disk will be created.
  * virtual_disk_dir - Required - A subdirectory to contain the virtual disk. (Can be the same as guest_name)
  * virtual_disk_name - Optional - Virtual Disk Name.  (ext must be .vmdk)
  * virtual_disk_size - Optional - Virtual Disk size in GB. Default 1GB.
  * virtual_disk_type - Optional - Virtual Disk type.  (thin, zeroedthick or eagerzeroedthick) Default 'thin'.

* resource "esxi_guest"
  * guest_name - Required - The Guest name.
  * ip_address - Computed - The IP address reported by VMware tools.
  * boot_disk_type - Optional - Guest boot disk type. Default 'thin'.  Available thin, zeroedthick, eagerzeroedthick.
  * boot_disk_size - Optional - Specify boot disk size or grow cloned vm to this size.
  * guestos - Optional - Default will be taken from cloned source.
  * boot_firmware - Optional - If "efi", enable efi boot. - Default "bios" (BIOS boot)
  * clone_from_vm - Source vm to clone. Mutually exclusive with ovf_source option.
  * ovf_source - ovf files or URLs to use as a source. Mutually exclusive with clone_from_vm option.
  * disk_store - Required - esxi Disk Store where guest vm will be created.
  * resource_pool_name - Optional - Any existing or terraform managed resource pool name. - Default "/".
  * memsize - Optional - Memory size in MB.  (ie, 1024 == 1GB). See esxi documentation for limits. - Default 512 or default taken from cloned source.
  * numvcpus - Optional - Number of virtual cpus.  See esxi documentation for limits. - Default 1 or default taken from cloned source.
  * virthwver - Optional - esxi guest virtual HW version.  See esxi documentation for compatible values. - Default 8 or taken from cloned source.
  * network_interfaces - Array of up to 10 network interfaces.
    * virtual_network - Required for each Guest NIC - This is the esxi virtual network name configured on esxi host.
    * mac_address - Optional -  If not set, mac_address will be generated by esxi.  Be sure to follow VMware mac address rules, otherwise your VM will not start.
    * nic_type - Optional - See esxi documentation for compatibility list. - Default "e1000" or taken from cloned source.
  * virtual_disks - Optional - Array of additional storage to be added to the guest.
    * virtual_disk_id - Required - virtual_disk.id from esxi_virtual_disk resource.
    * slot - Required - SCSI_Ctrl:SCSI_id.  Range  '0:1' to '3:15'.  SCSI_id 7 is not allowed.
  * power - Optional - on, off.
  * guest_startup_timeout - Optional - The amount of guest uptime, in seconds, to wait for an available IP address on this virtual machine. Default 120s.
  * guest_shutdown_timeout - Optional - The amount of time, in seconds, to wait for a graceful shutdown before doing a forced power off. Default 20s.
  * notes - Optional - The Guest notes (annotation).
  * guestinfo - Optional - The Guestinfo root
    * metadata - Optional - A JSON string containing the cloud-init metadata.
    * metadata.encoding - Optional - The encoding type for guestinfo.metadata. (base64 or gzip+base64)
    * userdata - Optional - A YAML document containing the cloud-init user data.
    * userdata.encoding - Optional - The encoding type for guestinfo.userdata. (base64 or gzip+base64)
    * vendordata - Optional - A YAML document containing the cloud-init vendor data.
    * vendordata.encoding - Optional - The encoding type for guestinfo.vendordata (base64 or gzip+base64)
  * ovf_properties - Optional - List of ovf properties to override in ovf/ova sources.
    * key - Required - Key of the property
    * value - Required - Value of the property
  * ovf_properties_timer - Optional - Length of time to wait for ovf_properties to process.  Default 90s.

* resource "esxi_vswitch"
  * name - Required - The vswitch name.
  * ports - Optional - The number of ports available on the vswitch.  Default 128.
  * mtu - Optional - The mtu. Default 1500
  * promiscuous_mode - Optional - Enable Promiscuous Mode (true/false) - Default false
  * mac_changes - Optional - Enable MAC Changes (true/false) - Default false.
  * forged_transmits - Optional - Enable Forged Transmits (true/false) - Default false.
  * uplink - Optional - Array of up to 32 uplinks.
    * name - Required - The uplink name. (for example vnic2)

* resource "esxi_portgroup"
  * name - Required - The portgroup name.
  * vswitch - Required - The vswitch to connect to.
  * vlan - Optional - The vlan id of the portgroup - Default 0.

Using ovf_source & clone_from_vm
--------------------------------
* clone_from_vm clones from sources on the esxi host.
  * The source VM must be powered off.
  * If the source VM is stored in a resource group, you must specify the path, for example.
    * clone_from_vm = "my_resource_group/my_source_vm"
* ovf_source clones from sources on your local hard disk or a URL.
  * A local ova, ovf, vmx file.  See known issues (below) with vmx sources.
  * URL specifying a remote ova.
    * For example, Ubuntu cloud-images: https://cloud-images.ubuntu.com/trusty/current/trusty-server-cloudimg-amd64.ova
* If neither is specified, then a bare-metal VM will be created.  There will be no OS on this vm.  If the VM is powered on, it will default to a network PXE boot.
* ovf_source & clone_from_vm are mutually exclusive.

License
-------

BSD

Author Information
------------------

An optional section for the role authors to include contact information, or a website (HTML is not allowed).
